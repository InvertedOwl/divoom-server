<script setup>
import { ref } from 'vue';

const pixelData = ref([
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ],
    [
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295,
        4294967295
    ]
]);
const color = ref(16777215);


async function clickedIndex(rowIndex, pixelIndex) {
  console.log(color.value.toString(16))
  pixelData.value[rowIndex][pixelIndex] = color.value;
  await fetch("/pixel", {
    method: "POST",
    headers: {
      "Content-Type": "application/json; charset=utf-8"
    },
    body: JSON.stringify({
      "x": pixelIndex,
      "y": rowIndex,
      "color": (color.value * 256) + 255
    })
  });

  update();
}

async function update() {
  const response = await fetch("/pixels");
  pixelData.value = await response.json();
}

setInterval(() => {
  console.log("Updating..");
  update();
}, 2000);


update();


</script>

<template>
  <div class="global-container">
    <h1>My display</h1>
    <input type="color" value="#FFFFFF" name="" id="" @input="event => color = parseInt(event.target.value.slice(1), 16)">
    <div class="grid-container">
      <div v-for="(pixelRow, rowIndex) in pixelData" :key="pixelRow" class="row">
        <div v-for="(pixel, pixelIndex) in pixelRow" :key="pixel" class="pixel">
          <button @click="clickedIndex(rowIndex, pixelIndex)" :style="{ 'background-color': '#' + pixelData[rowIndex][pixelIndex].toString(16) }"></button>
        </div>
      </div>
  </div>

  </div>

</template>

<style scoped>
.global-container {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}

h1 {
  text-align: center;
}

.grid-container {
  display: flex;
  margin: 0;
}
.grid-container * {
  margin: 0;
  padding: 0;
}

button {
  width: 20px;
  height: 20px;
  margin: 0;
  padding: 0;
  border: 1px solid black;
}
.row {
}
.pixel {
  height: 20px;
  width: 20px;
}
</style>
